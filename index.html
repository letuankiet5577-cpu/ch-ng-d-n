<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <!-- Mobile-friendly viewport (iPhone notch-safe) -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#070b08" />
  <title>RPG Web - Hổ Săn Mồi + Hang Hổ + Chỉ số</title>
<link rel="stylesheet" href="style_clean.css">
</head>
<body>
  <div id="hud">
    <div id="hudControls" aria-label="HUD controls">
      <button id="hudToggle" class="iconBtn" type="button" title="Thu gọn / mở rộng HUD">▾</button>
      <button id="hudSettings" class="iconBtn" type="button" title="Cài đặt">⚙</button>
    </div>

    <div id="hudTopRow" style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
      <div><b>Seed</b></div>
      <input id="seedInput" placeholder="vd: jungle-01" />
      <button id="regenBtn">Tạo lại map</button>

      <div class="pill" id="scenePill">Ngoài rừng</div>
      <div class="pill"><span class="muted">Giờ:</span> <span id="timeLabel"></span></div>
      <div class="pill"><span class="muted">Thời tiết:</span> <span id="weatherLabel"></span></div>
      <div class="pill"><span class="muted">Thú rừng:</span> <span id="animalCountLabel"></span></div>
    </div>

    <div class="bars">
      <div class="barRow">
        <div class="label"><span class="lblFull">Máu</span><span class="lblShort">HP</span></div>
        <div class="bar"><div class="barFill" id="hpFill"></div></div>
        <div class="barText" id="hpText"></div>
      </div>
      <div class="barRow">
        <div class="label"><span class="lblFull">Đói</span><span class="lblShort">Đói</span></div>
        <div class="bar"><div class="barFill" id="hungerFill"></div></div>
        <div class="barText" id="hungerText"></div>
      </div>
      <div class="barRow">
        <div class="label"><span class="lblFull">Buồn ngủ</span><span class="lblShort">Ngủ</span></div>
        <div class="bar"><div class="barFill" id="sleepFill"></div></div>
        <div class="barText" id="sleepText"></div>
      </div>
    </div>

    <div class="skills">
      <div class="muted" style="font-weight:900;">Kỹ năng</div>
      <div class="skillRow">
        <div class="skillPill" id="ab1">1 Cào</div>
        <div class="skillPill" id="ab2">2 Cắn</div>
        <div class="skillPill" id="ab3">3 Vồ</div>
        <div class="skillPill" id="ab4">4 Gầm</div>
      </div>
      <div class="muted" id="stateLabel" style="font-weight:900;"></div>
    </div>
  </div>

  <div id="miniPanel">
    <div id="miniTitle">
      <div id="miniName">Mini Map (Rừng)</div>
      <div class="muted" id="posLabel"></div>
    </div>
    <canvas id="minimap" width="224" height="224"></canvas>
  </div>

  <div id="toast">...</div>
  <div id="err"></div>

  <canvas id="view"></canvas>

  <!-- Mobile controls (hiện trên màn hình nhỏ / thiết bị cảm ứng) -->
  <div id="mobileControls" aria-label="Mobile controls">
    <div id="joyWrap">
      <div id="joyBase" aria-label="Joystick">
        <div id="joyStick"></div>
      </div>
    </div>

    <div id="actionWrap" aria-label="Actions">
      <button class="mBtn" id="btnAttack" type="button">Tấn công</button>
      <button class="mBtn" id="btnSprint" type="button">Chạy</button>
      <button class="mBtn" id="btnLock" type="button">Khoá</button>
      <button class="mBtn" id="btnEnter" type="button">Hang</button>
      <button class="mBtn" id="btnHint" type="button">?</button>
    </div>
  </div>

  <!-- Settings / Help overlay -->
  <div id="settingsOverlay" aria-hidden="true">
    <div id="settingsPanel" role="dialog" aria-label="Cài đặt">
      <div class="settingsHeader">
        <div class="settingsTitle">Cài đặt</div>
        <button id="settingsClose" class="iconBtn" type="button" aria-label="Đóng">✕</button>
      </div>
      <div class="settingsBody">
        <div class="setRow">
          <label class="setLabel">
            <input type="checkbox" id="setHudMini">
            <span><b>HUD gọn</b> (ít che tầm nhìn)</span>
          </label>
        </div>
        <div class="setRow">
          <label class="setLabel">
            <input type="checkbox" id="setSmallUI">
            <span><b>UI nhỏ</b> (điện thoại: ít che màn)</span>
          </label>
        </div>

        <div class="setRow">
          <label class="setLabel">
            <input type="checkbox" id="setShowMinimap">
            <span>Hiện <b>Mini map</b></span>
          </label>
        </div>
        <div class="setRow">
          <label class="setLabel">
            <input type="checkbox" id="setShowHint">
            <span>Hiện <b>gợi ý nổi</b> ở màn hình</span>
          </label>
        </div>

        <div class="divider"></div>
        <div class="setRow">
  <div style="font-weight:900;margin-bottom:6px;">Lưu game</div>
  <div class="skillRow">
    <button class="mBtn" id="btnSaveGame" type="button">Lưu</button>
    <button class="mBtn" id="btnLoadGame" type="button">Tải</button>
    <button class="mBtn" id="btnClearSave" type="button">Xoá</button>
  </div>
  <div class="muted">Lưu trên thiết bị này (trình duyệt). Chỉ lưu vị trí/chỉ số/thời gian.</div>
</div>
        <details open>
          <summary>Hướng dẫn (Điện thoại)</summary>
          <div class="helpText">
            <div>• Di chuyển: <b>joystick</b> góc trái.</div>
            <div>• Tấn công: chạm <b>Tấn công</b> để đánh. Nếu chưa khoá mục tiêu → sẽ ưu tiên <b>cào diện rộng</b>. Giữ nút để cào rộng.</div>
            <div>• Chạy: giữ nút <b>Chạy</b>. Khoá: nút <b>Khoá</b>. Hang: nút <b>Hang</b>.</div>
            <div>• Zoom: <b>pinch 2 ngón</b>.</div>
          </div>
        </details>

        <details>
          <summary>Hướng dẫn (PC)</summary>
          <div class="helpText">
            <div>• Di chuyển: <span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span> / mũi tên. Zoom: <span class="kbd">Q</span>/<span class="kbd">E</span>.</div>
            <div>• Tấn công: Chuột trái click để <b>cào</b>. Giữ chuột trái để <b>cào diện rộng</b>. Cào 4 lần → tự <b>vồ</b>.</div>
            <div>• Khoá mục tiêu: click vào kẻ địch hoặc <span class="kbd">TAB</span>. Bỏ khoá: <span class="kbd">X</span>.</div>
            <div>• Vào hang: <span class="kbd">G</span>. Chạy nhanh: Chuột phải hoặc <span class="kbd">Shift</span>. Ăn: <span class="kbd">F</span>. Ngủ: <span class="kbd">SPACE</span>.</div>
            <div>• Ẩn/hiện gợi ý nổi: <span class="kbd">H</span>.</div>
          </div>
        </details>
      </div>
    </div>
  </div>

  <div id="hint" aria-label="Gợi ý">
    <button id="hintClose" class="iconBtn" type="button" title="Tắt gợi ý" aria-label="Tắt gợi ý">✕</button>
    <div class="hintLine"><b>Mẹo:</b> Bấm <b>?</b> (điện thoại) hoặc <b>⚙</b> để mở <b>Cài đặt</b>. Di chuyển: <b>joystick</b>. Tấn công: nút <b>Tấn công</b>.</div>
  </div>
  <script src="story.js"></script>
  <script src="game_core.js"></script>
  <script src="game_dom.js"></script>
  <script src="game_map.js"></script>
  <script src="game_entities.js"></script>
  <script src="game_combat.js"></script>
  <script src="game_render.js"></script>
  <script src="game_main.js"></script>
</body>
</html>
